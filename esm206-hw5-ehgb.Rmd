---
title: "esm206-hw5-ehgb"
author: "Evan Heberlein & Grace Brofman"
date: "11/25/2019"
output: html_document
---

```{r setup, include=FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Intro & methods last

Results:
Section A visualize - Evan
Section B table - Grace
Section C chi squared - Grace
Section D t-test - Grace
Section E ANOVA - Evan

```{r, include = FALSE}
library(tidyverse)
library(janitor)
library(beeswarm)
library(car)
library(ggbeeswarm)
library(kableExtra)
library(lubridate)
library(effsize)
library(DT)
library(plotly)
library(RColorBrewer)
```

```{r, include = FALSE}
salamanders <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  filter(species == "DITE") %>% 
  mutate(sampledate = lubridate::mdy(sampledate)) %>% 
  mutate(year = lubridate::year(sampledate))

view(salamanders)

salamanders_counted <- salamanders %>%
  count(year, section) %>% 
  mutate(section = replace(section, section == "OG", "Old growth")) %>%
  mutate(section = replace(section, section == "CC", "Clear cut"))


view(salamanders_counted)

salamander_line <- ggplot(data = salamanders_counted,
                          aes(x = year,
                              y = n,
                              color = section)) +
  
  geom_line(size = 2) +
  theme_bw() +
  scale_x_continuous(expand = c(0,0)) + 
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Year", y = "Annual count") +
  ggtitle("Annual count of salamanders (Onchorhyncus clarkii)")

salamander_line
```

### Results B: Table
Results B: Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek. Using only Pacific giant salamander observations from 2017, create a finalized table showing the counts and proportions of salamanders observed in different channel classifications (pool, cascade, or side-channel) within Mack Creek for the two sections (OG and CC). Add a table caption above the table. Note: Weâ€™re only interested in Pacific giant salamanders observed in the creek, so you should exclude salamanders observed in isolated pools (IP) disconnected from the channel. 

```{r, include = FALSE}

salamanders_2017 <- salamanders %>%   # contains only section and unittype
  filter(year == "2017") %>% 
  select(section, unittype) %>% 
  filter(unittype != "IP")


# finding salamander counts by section and unit type (cascade, pool, side channel)
salamander_2017_counts <- salamanders_2017 %>%  
  count(section, unittype)


# making a table / wider format / contingency table
salamander_2017_table <- salamander_2017_counts %>% 
  pivot_wider(names_from = unittype,
              values_from = n)

# making a nicer table! 
salamander_2017_props <- salamander_2017_table %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_ns(position = "front") %>% 
  rename(Section = section,
         Cascade = C,
         Pool = P,
         Sidechannel = SC)

salamander_2017_props

kable(salamander_2017_props) %>% 
  kable_styling()

# Need to rename CC and OG to Clear cut and Old growth!
# Add table caption above table

```

### Results C: Results C: Chi Square
Using the 2017 counts found in Results B above, answer: is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)? Another way to ask this: Regarding the locations where salamanders were observed in Mack Creek in 2017, is there a significant effect of forest condition (old growth or clear cut) on where in the channel salamanders are found (channel classification)? Report your statistical findings in text, in the context of the actual counts / proportions you present in the table. 

```{r, include = FALSE}
# Is there an effect of forest condition (OG vs. CC) on where salamanders are found (channel classification)?

chi_counts <- salamander_2017_table %>% 
  select(-section) %>% 
    rename(Cascade = C,
         Pool = P,
         Sidechannel = SC)

chi_counts
```

H0:
- There is no significant association between forest condition and salamander location.
- Forest condition and salamander location are independent of one another.

```{r, include = FALSE}

salamander_chi <- chisq.test(chi_counts)

salamander_chi

```

p-value = 0.063 -> cannot reject H0

Conclusion:
- There is no significant association between forest condition and salamander location.

** Add in-line referencing**



### Results D: 2 sample unpaired t-test
 Compare weights of Pacific giant salamanders in clear cut and old growth forest sections of the creek in 2017. Only considering creek section (OG or CC) as a variable (not further factoring by channel classification), answer: Is there a significant difference in mean weights for Pacific giant salamanders observed in the two forest sections (clear cut and old growth) in 2017? 
 
```{r, include = FALSE}

salamander_17_d <- salamanders %>% 
  filter(year == "2017") %>% 
  select(section, weight)

# data exploration:

ggplot(data = salamander_17_d,
       aes(x = weight)) +
  geom_histogram() +
  facet_wrap(~section)
# both sections seem generally normally distributed...
 ggplot(data = salamander_17_d,
        aes(sample = weight)) +
   geom_qq() +
   facet_wrap(~section)
 # QQ plots do not show a normal distribution, but can still compare means. Because of CLT, sampling distribution of the means will be normal.

mean_weight_17 <- salamander_17_d %>% 
  group_by(section) %>% 
  summarize(mean_weight = mean(weight, na.rm = TRUE))  # exclueds observation 696 with no observed weight

# How likely is it that we could have found sample means that are at least this different (7.78, 6.58) by random chance if the true difference in population means is zero?

# H0: there is no difference in means/means are equal
# Null: means are not equal

salamander_ttest <- t.test(weight ~ section, data = salamander_17_d)

salamander_ttest

# p-value = 0.096, cannot reject H0
# conclusion: there is not a significant difference in weights between salamanders found in old growth forests vs. clear cut sections in 2017.

salamander_cohend <- cohen.d(weight ~ section, data = salamander_17_d) 
# is this necessary? since we cannot reject null hypothesis?

```
 

